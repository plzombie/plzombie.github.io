<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Рисование кривых Безье 2-го порядка</title>
<script type="text/javascript">
	var cavnas1, context1, canvas2, context2;
	var width, height;
	var bezier_accuracy = 200;
	var bezierpoints = { isDotGrabbed: 0, data: [] }; // Точки кривых Безье
	// Очищает данные и перерисовывает изображения
	function RedrawMyImages() {
		points = { isDotGrabbed: 0, data: [] };
		bezierpoints = { isDotGrabbed: 0, data: [] };
		
		context1.fillStyle = "rgb(255, 255, 255)";
		context1.fillRect(0, 0, width, height);
		DrawDots(context1, points, "rgb(0, 0, 0)");
		
		context2.fillStyle = "rgb(0, 0, 0)";
		context2.fillRect(0, 0, width, height);
		DrawBezier(context2, bezierpoints, "rgb(255, 64, 192)");
	}
	// Рисует точки из dots
	function DrawDots(context, dots, color) {
		for(var i = 0; i < dots.data.length; i++) {
			context.fillStyle = color;
			context.fillRect(dots.data[i][0], dots.data[i][1], 1, 1);
		}
	}
	function DrawBezier(context, b_points, color)
	{
		if(bezier_accuracy <= 0) bezier_accuracy = 200;
		
		for(var i = 0; i+2 < b_points.data.length; i+= 2) {
			for(var j = 0; j <= bezier_accuracy; j++) {
				var t = j/bezier_accuracy, x, y;
				
				x = b_points.data[i][0]*(1-t)*(1-t)+2*b_points.data[i+1][0]*(1-t)*t+b_points.data[i+2][0]*t*t;
				y = b_points.data[i][1]*(1-t)*(1-t)+2*b_points.data[i+1][1]*(1-t)*t+b_points.data[i+2][1]*t*t;
				
				context.fillStyle = color;
				context.fillRect(x, y, 1, 1);
			}
		}
	}
	function DrawScene()
	{
		bezier_accuracy = document.getElementById('bezieraccuracy').value;
		context2.fillStyle = "rgb(0, 0, 0)";
		context2.fillRect(0, 0, width, height);
		DrawBezier(context2, bezierpoints, "rgb(255, 64, 192)");
		if(document.getElementById('bezieraccuracy').value != bezier_accuracy)
			document.getElementById('bezieraccuracy').value = bezier_accuracy;
	}
	// Добавляет в dots точку, на которую указали. Здесь event - событие, canvas - холст, на который вы кликнули
	function AddClickedDots(event, canvas, context, dots) {
		var p = canvas;
		var x = event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;
		var y = event.clientY+document.body.scrollTop+document.documentElement.scrollTop;
		while(p) {
			x -= p.offsetLeft;
			y -= p.offsetTop;
			p = p.offsetParent;
		}
		var dot = [x, y, 1];
		if(dots.isDotGrabbed > 0) {
			dots.data[dots.isDotGrabbed-1] = dot;
			dots.isDotGrabbed = 0;
			
			context.fillStyle = "rgb(255, 255, 255)";
			context.fillRect(0, 0, width, height);
			DrawDots(context, dots, "rgb(0, 0, 0)");
		} else {
			for(var i = 0; i < dots.data.length; i++) {
				if((Math.abs(x-dots.data[i][0]) <= 3) &&
					(Math.abs(y-dots.data[i][1]) <= 3)) {
					dots.isDotGrabbed = i+1;
					context.fillStyle = "rgb(0, 255, 0)";
					context.fillRect(dots.data[i][0]-1, dots.data[i][1]-1, 3, 3);
					context.fillStyle = "rgb(0, 0, 0)";
					context.fillRect(dots.data[i][0], dots.data[i][1], 1, 1);
					return;
				}
			}
			context.fillStyle = "rgb(0, 0, 0)";
			context.fillRect(x, y, 1, 1);
			dots.data[dots.data.length] = dot;
		}
	}
	function AddDot(event) {
		AddClickedDots(event, canvas1, context1, bezierpoints);
	}
	window.onload = function () {
		canvas1 = document.getElementById('canvas1');
		context1 = canvas1.getContext('2d');
		width = canvas1.width;
		height = canvas1.height;
		
		canvas2 = document.getElementById('canvas2');
		context2 = canvas2.getContext('2d');
		canvas2.width = width;
		canvas2.height= height;
		
		RedrawMyImages();
		
		document.getElementById('bezieraccuracy').value = bezier_accuracy;
		
		canvas1.addEventListener('click', AddDot);
		
		setInterval("DrawScene();", 50);
	}
</script>
</head>
<body style="background: gray;">
<table>
<tr>
	<td>Точки кривой<br/><canvas id="canvas1" width="400" height="200"></canvas></td>
	<td>Итоговая кривая Безье 2-го порядка<br/><canvas id="canvas2" width="400" height="200"></canvas></td>
</tr>
<tr>
	<td><button onclick="RedrawMyImages();">Очистить</button></td>
	<td>Количество разбиений:<input type="number" id="bezieraccuracy" value="0" step="0.01" style="width:80px"></td>
</tr>
</table>
</body>
</html>